asyncapi: 2.0.0
info:
  title: Todo Service
  version: 1.0.0
  description: |
    Subscribes to the following messages:
    - `todo.created`
    - `todo.completed`

    Publishes the following notification messages:
    - `todo.created.ok`
    - `todo.created.error`
    - `todo.completed.ok`
    - `todo.completed.error`
servers:
  nats:
    url: nats://nats:4222
    protocol: nats
channels:
  todo.created:
    publish:
      message:
        $ref: "#/components/messages/TodoCreated"
  todo.completed:
    publish:
      message:
        $ref: "#/components/messages/TodoCompleted"
  todo.created.ok:
    subscribe:
      message:
        $ref: "#/components/messages/TodoCreatedOk"
  todo.created.error:
    subscribe:
      message:
        $ref: "#/components/messages/TodoError"
  todo.completed.ok:
    subscribe:
      message:
        $ref: "#/components/messages/TodoCompleted"
  todo.completed.error:
    subscribe:
      message:
        $ref: "#/components/messages/TodoError"
components:
  messages:
    TodoCreated:
      payload:
        type: object
        required: [todo]
        properties:
          todo:
            type: object
            required: [name]
            properties:
              name:
                type: string
                description: Name
                example: Demo
                minLength: 1
                maxLength: 100
              description:
                description: Description
                anyOf:
                  - type: string
                    example: Prepare the demo
                    minLength: 1
                    maxLength: 1000
                  - type: "null"
    TodoCompleted:
      payload:
        type: object
        required: [id]
        properties:
          id:
            type: integer
            description: ID
            example: 1
            minimum: 1
    TodoCreatedOk:
      payload:
        type: object
        required: [todo]
        properties:
          todo:
            type: object
            description: Todo
            required: [id, name, created_at, updated_at]
            properties:
              id:
                type: integer
                description: ID
                example: 1
                minimum: 1
              name:
                type: string
                description: Name
                example: Demo
                minLength: 1
                maxLength: 100
              description:
                description: Description
                anyOf:
                  - type: string
                    example: Prepare the demo
                    minLength: 1
                    maxLength: 1000
                  - type: "null"
              created_at:
                type: string
                description: Created at
                example: "2021-05-01T17:30:00Z"
                format: date-time
              updated_at:
                type: string
                description: Updated at
                example: "2021-05-01T18:00:00Z"
                format: date-time
    TodoError:
      payload:
        type: object
        required: [code]
        properties:
          code:
            type: string
            description: Error code
            example: todo.completed.error
            minLength: 1
            maxLength: 100
          message:
            description: Error message
            anyOf:
              - type: string
                example: Invalid message payload
                minLength: 1
                maxLength: 1000
              - type: "null"
